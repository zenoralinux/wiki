   


<img src="https://github.com/user-attachments/assets/2375bc8c-c908-47f5-9f1a-c08bc028b7b7" width="75%">

# پیکربندی خودکار بارگذاری KVM

به مستندات پیکربندی خودکار KVM خوش آمدید.

این بسته به‌طور خودکار ماژول‌های کرنل ضروری KVM را هنگام بوت بارگذاری می‌کند تا پشتیبانی از مجازی‌سازی سخت‌افزاری را برای پردازنده‌های Intel و AMD در سیستم‌های Arch Linux فعال کند.

---

## 📜 مرور کلی

KVM (ماشین مجازی مبتنی بر کرنل) یک ماژول بومی در کرنل لینوکس است که امکان مجازی‌سازی کامل با استفاده از قابلیت‌های شتاب‌دهنده سخت‌افزاری سیستم شما (مانند Intel VT-x یا AMD-V) را فراهم می‌کند.

با بارگذاری خودکار ماژول‌های موردنیاز در هنگام بوت، این بسته به کاربران کمک می‌کند:

- ماشین‌های مجازی را با عملکردی نزدیک به عملکرد بومی اجرا کنند.  
- نیازی به پیکربندی دستی ماژول‌های کرنل نداشته باشند.  
- با هر دو نوع CPU (Intel و AMD) سازگاری داشته باشند.  

---

## 🔧 ویژگی‌ها

- بارگذاری خودکار ماژول‌های KVM: شامل `kvm`، `kvm-intel` و `kvm-amd` از طریق systemd در زمان بوت  
- پشتیبانی از پردازنده‌های Intel و AMD  
- بهینه‌سازی‌شده برای کرنل Zen لینوکس آرچ و همچنین کرنل‌های استاندارد  
- سبک و غیرمداخله‌گر: در زمان غیرفعال بودن، تاثیری بر عملکرد سیستم ندارد  
- عملکرد ایمن: اگر CPU از KVM پشتیبانی نکند، ماژولی بارگذاری نمی‌شود  

---

## 🛠 نصب

```bash
sudo pacman -S zenora-qemu-kvm
```

---

## 🔧 نصب درایورها در ماشین مجازی KVM

برای عملکرد بهتر ماشین‌های مجازی، باید درایورهای مناسب را در سیستم‌عامل مهمان نصب و پیکربندی کنید.

### 1. عامل مهمان QEMU (QEMU Guest Agent)

برای ارتباط بهتر میزبان و ماشین مجازی و قابلیت‌هایی مانند خاموش‌کردن یا توقف از راه دور، نصب این عامل ضروری است.

برای سیستم‌های مبتنی بر Ubuntu/Debian:

```bash
sudo apt-get install qemu-guest-agent
```

برای zenora Linux:

```bash
sudo pacman -S qemu-guest-agent
```

سپس سرویس را فعال و اجرا کنید:

```bash
sudo systemctl enable qemu-guest-agent
sudo systemctl start qemu-guest-agent
```

این کار امکان انتقال فایل، اشتراک کلیپ‌بورد و خاموش شدن خودکار را فراهم می‌کند.

---

### 2. درایورهای VirtIO (برای عملکرد بهتر)

درایورهای VirtIO برای ایجاد I/O سریع و کارآمد در ماشین‌های مجازی ضروری هستند.

#### نصب درایور VirtIO در سیستم‌عامل مهمان:

**برای ویندوز:**
- فایل ISO درایور VirtIO را از [مخزن Fedora](https://fedoraproject.org/wiki/Windows_Virtio_Drivers) دانلود کنید.
- آن را به درایو CD/DVD ماشین مجازی متصل کنید.
- داخل ویندوز، درایورها را برای دیسک، شبکه و سایر دستگاه‌ها نصب کنید.

**برای سیستم‌عامل‌های لینوکسی (مثلاً zenora Linux):**

```bash
sudo pacman -S virtio
```

ماژول VirtIO معمولاً در کرنل لینوکس موجود است، اما نصب این بسته ابزارهای مدیریت VirtIO را فراهم می‌کند.

---

### 3. SPICE و QXL (برای بهبود عملکرد گرافیکی)

برای بهبود عملکرد گرافیکی (به‌ویژه در محیط‌های دسکتاپ)، می‌توان از SPICE و درایور QXL استفاده کرد.

**برای سیستم‌عامل‌های لینوکسی مهمان:**

```bash
sudo pacman -S xf86-video-qxl spice-vdagent
```

**برای ویندوز:** ابزارهای SPICE را از VirtIO ISO نصب کنید.

---

### 4. اشتراک کلیپ‌بورد (برای مهمان‌های لینوکس)

برای فعال‌سازی کپی/پیست بین میزبان و مهمان، اطمینان حاصل کنید که spice-vdagent نصب و در حال اجرا است:

```bash
sudo systemctl enable spice-vdagentd
sudo systemctl start spice-vdagentd
```

---

## 🔍 نحوه عملکرد

پس از نصب، فایل پیکربندی زیر ایجاد می‌شود:

```
/etc/modules-load.d/kvm.conf
```

محتوای فایل:

```
kvm
kvm_intel
kvm_amd
```

در زمان بوت، systemd این ماژول‌ها را بارگذاری می‌کند. کرنل به‌طور خودکار ماژول‌های ناسازگار را نادیده می‌گیرد.

---

## 🏁 بررسی وضعیت ماژول‌ها

برای اطمینان از بارگذاری ماژول‌های KVM:

```bash
lsmod | grep kvm
```

برای بررسی پشتیبانی CPU از مجازی‌سازی:

```bash
lscpu | grep Virtualization
```

مشاهده پیام‌های کرنل مرتبط با KVM:

```bash
dmesg | grep kvm
```

---

## ⚙️ نیازمندی BIOS/UEFI

اطمینان حاصل کنید که مجازی‌سازی سخت‌افزاری در تنظیمات BIOS/UEFI فعال شده باشد:

- برای پردازنده‌های Intel: فعال‌سازی VT-x  
- برای پردازنده‌های AMD: فعال‌سازی AMD-V  

---

## ❗ رفع اشکال

- KVM کار نمی‌کند؟ مطمئن شوید که مجازی‌سازی در BIOS فعال باشد.  
- ماژول‌ها بارگذاری نمی‌شوند؟ بررسی کنید که فایل `/etc/modules-load.d/kvm.conf` ایجاد شده و حاوی نام ماژول‌ها باشد.  
- خطا در لاگ؟ از دستور `dmesg` برای بررسی پیام‌های مربوط به KVM استفاده کنید.  

---

## 📚 منابع بیشتر

- مستندات KVM - کرنل لینوکس:  
  [https://www.kernel.org/doc/html/latest/virtualization/kvm.html](https://www.kernel.org/doc/html/latest/virtualization/kvm.html)

- مستندات QEMU:  
  [https://www.qemu.org/docs/master/](https://www.qemu.org/docs/master/)

- Arch Wiki - صفحه KVM:  
  [https://wiki.archlinux.org/title/KVM](https://wiki.archlinux.org/title/KVM)

- درایورهای VirtIO برای ویندوز:  
  [https://fedoraproject.org/wiki/Windows_Virtio_Drivers](https://fedoraproject.org/wiki/Windows_Virtio_Drivers)

- مستندات SPICE برای ماشین‌های مجازی:  
  [https://www.spice-space.org/](https://www.spice-space.org/)

---

## 📝 مجوز

این پروژه تحت مجوز MIT منتشر شده است.  
آزاد هستید که این بسته را با ذکر منبع استفاده، ویرایش و منتشر کنید.

---

## 🚀 مشارکت

مشارکت شما خوش‌آمد است! برای بهبود، رفع اشکال یا افزودن ویژگی‌های جدید، issue یا pull request باز کنید.

---

## 🙏 سپاس

از اینکه از **KVM Auto-Load Config** استفاده می‌کنید متشکریم — راهی ساده و سریع برای راه‌اندازی مجازی‌سازی در Arch Linux!
